import{_ as T,f as x,q as V,c as r,a as s,b as l,v as m,n as c,w,i as p,j as h,B as M,e as U,d as u,k as f,o as n,g as y,F as v,z as k,t as g,C as F}from"./app-CpCrk5cI.js";/* empty css            */const j={data(){return{id:null,payment_id:null,isFormManipulating:!1,submitted:!1,isEdit:!1,opened:!1,isDeletedTab:!1,patient_name:"",currentTab:"PAYMENTS",patient_file_number:"",data:[],deletedPayments:[],type:"",totalPayments:0,totalRemainingPayments:0,currentPayment:{},form:{amount:"",remaining_amount:"",date:"",notes:""}}},computed:{isPatientFilesDetails:function(){return this.$route.name==="patients-files-show"}},mounted(){this.id=this.$route.params.id,this.type=this.$route.query.type,this.getData();const o=this;bus.$on("item-deleted",function(){o.getData()})},methods:{back(){setTimeout(()=>this.$router.back(),100)},resetForm(){this.form={amount:"",remaining_amount:"",date:"",notes:""}},getData(){x.get(`/api/patients-files/${this.id}`).then(({data:o})=>{this.data=o.payments.map(e=>(e.isEdit=!1,e.isPayDebtOpened=!1,e)),this.deletedPayments=o.deleted_payments,this.data.length&&(this.patient_name=this.data[0].patient.name,this.patient_file_number=this.data[0].patient.file_number,this.totalPayments=this.data.reduce((e,b)=>e+ +b.amount,0),this.totalRemainingPayments=this.data.reduce((e,b)=>e+ +b.remaining_amount,0))})},print(){x.get(`/api/patients-files/${this.id}/print`).then(({data:o})=>{window.open(o.url,"blank"),console.log(o)})},addPayment(){this.submitted=!0;const o={...this.form,patient_id:this.id};o.date=V(o.date,"YYYY-MM-DD").add(1,"days"),x.post("/api/patients-files",o).then(({data:e})=>{bus.$emit("flash-message",{text:e.message,type:"success"}),this.resetForm(),this.isFormManipulating=!1,this.getData()}).catch(({response:e})=>{bus.$emit("flash-message",{text:e.data.message,type:"error"})}).finally(()=>{this.submitted=!1})},savePayment(o){this.submitted=!0;const e={amount:o.amount,remaining_amount:o.remaining_amount,date:o.date,notes:o.visit.notes,patient_id:this.id};o.isPayDebtOpened&&(e.is_pay_debt=!0,e.old_amount=this.currentPayment.amount),x.put(`/api/patients-files/${this.payment_id}`,e).then(({data:b})=>{bus.$emit("flash-message",{text:b.message,type:"success"}),this.resetForm(),o.isEdit=!1,this.getData()}).catch(({response:b})=>{bus.$emit("flash-message",{text:b.data.message,type:"error"})}).finally(()=>{this.submitted=!1})},deletePayment(o){if(this.payment_id=o,!this.opened){this.opened=!0;return}x.delete(`/api/patients-files/${o}`).then(({data:e})=>{bus.$emit("flash-message",{text:e.message,type:"success"}),this.getData()}).catch(({response:e})=>{bus.$emit("flash-message",{text:e.data.message,type:"error"})}).finally(()=>{this.submitted=!1,this.opened=!1})},restorePayment(o){x.post(`/api/patients-files/${o.id}/restore`).then(({data:e})=>{bus.$emit("flash-message",{text:e.message,type:"success"}),this.getData()}).catch(({response:e})=>{bus.$emit("flash-message",{text:e.data.message,type:"error"})}).finally(()=>{this.submitted=!1,this.opened=!1})},editPayment(o){o.isEdit=!0,this.payment_id=o.id,this.form={amount:o.amount,remaining_amount:o.remaining_amount,date:o.date,notes:o.visit.notes}},addPaymentForDebt(o){this.currentPayment={...o},o.isPayDebtOpened=!0,this.payment_id=o.id,o.amount=0},cancelPayment(o){o.isEdit=!1,o.isPayDebtOpened=!1,o.amount=this.currentPayment.amount},cancel(){this.resetForm(),this.isFormManipulating=!1},add(){this.isFormManipulating=!0,this.isEdit=!1}}},N={class:"px-12 py-6"},O={class:"w-full text-left"},Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},A={class:""},S={class:""},z={class:""},B={class:""},L={class:"sm:block mt-4"},R={class:"flex"},q={key:"1",class:"bg-white min-w-full divide-y divide-gray-200"},G={class:"bg-gray-200 text-gray-600 text-sm leading-normal"},H={class:"py-2 px-3 text-left"},I={class:"divide-y divide-gray-200"},J={key:0},K={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},Q=["disabled"],W={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-700"},X=["disabled"],Z={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-700"},$=["disabled"],ee={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},te=["disabled"],se={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},ie={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},oe={key:0},ne=["onUpdate:modelValue","disabled"],re={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-700"},de={key:0},ae={class:"font-medium"},le=["onUpdate:modelValue","disabled"],me={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-700"},ue={key:0},ge=["onUpdate:modelValue","disabled"],ce={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},be={key:0},pe=["onUpdate:modelValue","disabled"],xe={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},fe=["onClick"],he=["onClick"],ye=["onClick"],_e=["onClick"],we={key:"2",class:"bg-white min-w-full divide-y divide-gray-200"},ve={class:"divide-y divide-gray-200"},ke={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},Pe={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-700"},De={class:"font-medium"},Ee={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-700"},Ce={key:0},Te={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},Ve={class:"px-3 py-3 whitespace-no-wrap border-b border-gray-200 leading-5 text-gray-500"},Me=["onClick"],Ue={key:0,class:c("fixed z-10 inset-0 overflow-y-auto "),"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Fe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},je={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row"};function Ne(o,e,b,Oe,i,d){const _=f("CAsyncButton"),P=f("c-icon-edit"),D=f("c-icon-delete"),E=f("c-icon-money"),C=f("c-icon-restore");return n(),r("div",N,[s("div",O,[s("button",{class:"py-1 items-center justify-center h-12 px-4 text-sm text-center text-gray-100 hover:text-gray-50 bg-purple-500 transition-colors duration-200 transform border rounded-lg lg:h-8 hover:bg-purple-600 focus:outline-none",onClick:e[0]||(e[0]=t=>d.print())},"طباعة")]),s("div",Y,[s("div",A,[e[17]||(e[17]=s("label",{for:"name",class:"block text-sm font-medium text-gray-700 text-right"},"الاسم",-1)),l(s("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=t=>i.patient_name=t),type:"text",disabled:"",class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,512),[[m,i.patient_name]])]),s("div",S,[e[18]||(e[18]=s("label",{for:"file_number",class:"block text-sm font-medium text-gray-700 text-right"},"رقم الملف",-1)),l(s("input",{id:"file_number","onUpdate:modelValue":e[2]||(e[2]=t=>i.patient_file_number=t),type:"text",disabled:"",class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,512),[[m,i.patient_file_number]])]),s("div",z,[e[19]||(e[19]=s("label",{for:"totalPayments",class:"block text-sm font-medium text-gray-700 text-right"},"إجمالي المبلغ المدفوع",-1)),l(s("input",{id:"totalPayments","onUpdate:modelValue":e[3]||(e[3]=t=>i.totalPayments=t),type:"text",disabled:"",class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,512),[[m,i.totalPayments]])]),s("div",B,[e[20]||(e[20]=s("label",{for:"totalPayments",class:"block text-sm font-medium text-gray-700 text-right"},"إجمالي المبلغ المتبقي",-1)),l(s("input",{id:"totalRemainingPayments","onUpdate:modelValue":e[4]||(e[4]=t=>i.totalRemainingPayments=t),type:"text",disabled:"",class:c([{"text-red-600":i.totalRemainingPayments>0},"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"])},null,2),[[m,i.totalRemainingPayments]])])]),s("div",L,[s("nav",R,[s("a",{href:"#",class:c("px-3 py-2 font-medium text-sm leading-5 rounded-md text-gray-500 hover:text-gray-700 focus:outline-none focus:text-indigo-600 focus:bg-indigo-200 "+(i.currentTab==="PAYMENTS"?"text-indigo-700 bg-indigo-200":"")),onClick:e[5]||(e[5]=w(t=>i.currentTab="PAYMENTS",["prevent"]))}," الدفعات ",2),s("a",{href:"#",class:c("ml-4 px-3 py-2 font-medium text-sm leading-5 rounded-md text-gray-500 hover:text-gray-700 focus:outline-none focus:text-indigo-600 focus:bg-indigo-200 "+(i.currentTab==="DELETED_PAYMENTS"?"text-indigo-700 bg-indigo-200":"")),onClick:e[6]||(e[6]=w(t=>i.currentTab="DELETED_PAYMENTS",["prevent"]))}," الدفعات المحذوفة ",2)])]),s("div",null,[p(M,{name:"list",tag:"div",class:"align-middle min-w-full overflow-x-auto shadow overflow-hidden sm:rounded-lg mt-8"},{default:h(()=>[i.currentTab==="PAYMENTS"?(n(),r("table",q,[s("thead",null,[s("tr",G,[e[21]||(e[21]=s("th",{colspan:"4",class:"py-2 px-3 text-right"},"الدفعات",-1)),s("th",H,[s("a",{href:"#",class:"ml-4 py-1 items-center justify-center h-12 px-4 text-sm text-center text-gray-100 hover:text-gray-50 bg-gray-800 transition-colors duration-200 transform border rounded-lg lg:h-8 hover:bg-gray-600 focus:outline-none",onClick:e[7]||(e[7]=(...t)=>d.add&&d.add(...t))}," إضافة ")])]),e[22]||(e[22]=s("tr",{class:"bg-gray-50 text-gray-600 text-sm leading-normal"},[s("th",{class:"py-2 px-3 text-right"},"الإجراء الذي تم"),s("th",{class:"py-2 px-3 text-right"},"المبلغ المدفوع"),s("th",{class:"py-2 px-3 text-right"},"المبلغ المتبقي"),s("th",{class:"py-2 px-3 text-right"},"التاريخ"),s("th",{class:"py-2 px-3 text-right"})],-1))]),s("tbody",I,[i.isFormManipulating?(n(),r("tr",J,[s("td",K,[l(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>i.form.notes=t),type:"text",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,Q),[[m,i.form.notes]])]),s("td",W,[l(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>i.form.amount=t),type:"number",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,X),[[m,i.form.amount]])]),s("td",Z,[l(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>i.form.remaining_amount=t),type:"number",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,$),[[m,i.form.remaining_amount]])]),s("td",ee,[l(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>i.form.date=t),type:"date",disabled:i.submitted},null,8,te),[[m,i.form.date]])]),s("td",se,[p(_,{loading:i.submitted,class:"ml-4 py-1 items-center justify-center h-12 px-4 text-sm text-center text-white bg-green-500 transition-colors duration-200 transform border rounded-lg lg:h-8 hover:bg-green-600 focus:outline-none",onClick:e[12]||(e[12]=t=>d.addPayment())},{default:h(()=>e[23]||(e[23]=[y(" حفظ ")]),void 0,!0),_:1},8,["loading"]),s("a",{href:"#",class:"ml-4 py-1 items-center justify-center h-12 px-4 text-sm text-center text-white bg-red-600 transition-colors duration-200 transform border rounded-lg lg:h-8 hover:bg-red-700 focus:outline-none",onClick:e[13]||(e[13]=(...t)=>d.cancel&&d.cancel(...t))}," إلغاء ")])])):u("",!0),(n(!0),r(v,null,k(i.data,t=>(n(),r("tr",{key:t.id},[s("td",ie,[t.isEdit?l((n(),r("input",{key:1,"onUpdate:modelValue":a=>t.visit.notes=a,type:"text",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,ne)),[[m,t.visit.notes]]):(n(),r("span",oe,g(t.visit.notes?t.visit.notes:"-"),1))]),s("td",re,[!t.isEdit&&!t.isPayDebtOpened?(n(),r("span",de,[s("b",ae,g(+t.amount),1)])):l((n(),r("input",{key:1,"onUpdate:modelValue":a=>t.amount=a,type:"number",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,le)),[[m,t.amount]])]),s("td",me,[t.isEdit?l((n(),r("input",{key:1,"onUpdate:modelValue":a=>t.remaining_amount=a,type:"number",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,ge)),[[m,t.remaining_amount]]):(n(),r("span",ue,[t.isPayDebtOpened?(n(),r("b",{key:1,class:c(["font-medium",{"text-red-500":t.remaining_amount>0}])},g(+(t.remaining_amount-t.amount)),3)):(n(),r("b",{key:0,class:c(["font-medium",{"text-red-500":t.remaining_amount>0}])},g(+t.remaining_amount),3))]))]),s("td",ce,[t.isEdit?l((n(),r("input",{key:1,"onUpdate:modelValue":a=>t.date=a,type:"date",disabled:i.submitted,class:"block border border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 mt-1 px-2 py-2 rounded-md shadow-sm sm:text-sm w-full"},null,8,pe)),[[m,t.date]]):(n(),r("span",be,g(t.date),1))]),s("td",xe,[!t.isEdit&&!t.isPayDebtOpened?(n(),r("a",{key:0,href:"#",class:"py-1 inline-flex h-12 px-2 text-sm text-center text-green-600 transition-colors duration-200 transform lg:h-8 hover:text-green-700 focus:outline-none",onClick:a=>d.editPayment(t)},[p(P,{size:"5",class:"transition-colors"})],8,fe)):u("",!0),!t.isEdit&&!t.isPayDebtOpened?(n(),r("a",{key:1,href:"#",class:"py-1 inline-flex h-12 px-2 text-sm text-center text-red-600 transition-colors duration-200 transform lg:h-8 hover:text-red-700 focus:outline-none",onClick:a=>d.deletePayment(t.id)},[p(D,{size:"5",class:"transition-colors"})],8,he)):u("",!0),t.remaining_amount>0&&!t.isPayDebtOpened&&!t.isEdit?(n(),r("a",{key:2,href:"#",class:"py-1 inline-flex h-12 px-2 text-sm text-center text-teal-600 transition-colors duration-200 transform lg:h-8 hover:text-teal-700 focus:outline-none",onClick:a=>d.addPaymentForDebt(t)},[e[24]||(e[24]=y(" > ")),p(E,{size:"5",class:"transition-colors"})],8,ye)):u("",!0),t.isEdit||t.isPayDebtOpened?(n(),F(_,{key:3,loading:i.submitted,class:"ml-4 py-1 items-center justify-center h-12 px-4 text-sm text-center text-white bg-green-500 transition-colors duration-200 transform border rounded-lg lg:h-8 hover:bg-green-600 focus:outline-none",onClick:a=>d.savePayment(t)},{default:h(()=>[y(g(t.isPayDebtOpened?"حفظ":"تعديل"),1)],void 0,!0),_:2},1032,["loading","onClick"])):u("",!0),t.isEdit||t.isPayDebtOpened?(n(),r("a",{key:4,href:"#",class:"ml-4 py-1 items-center justify-center h-12 px-4 text-sm text-center text-white bg-red-600 transition-colors duration-200 transform border rounded-lg lg:h-8 hover:bg-red-700 focus:outline-none",onClick:a=>d.cancelPayment(t)},e[25]||(e[25]=[s("span",null,"إلغاء",-1)]),8,_e)):u("",!0)])]))),128))])])):u("",!0),i.currentTab==="DELETED_PAYMENTS"?(n(),r("table",we,[e[26]||(e[26]=s("thead",null,[s("tr",{class:"bg-gray-200 text-gray-600 text-sm leading-normal"},[s("th",{colspan:"5",class:"py-2 px-3 text-right"},"الدفعات المحذوفة")]),s("tr",{class:"bg-gray-50 text-gray-600 text-sm leading-normal"},[s("th",{class:"py-2 px-3 text-right"},"الإجراء الذي تم"),s("th",{class:"py-2 px-3 text-right"},"المبلغ المدفوع"),s("th",{class:"py-2 px-3 text-right"},"المبلغ المتبقي"),s("th",{class:"py-2 px-3 text-right"},"التاريخ"),s("th",{class:"py-2 px-3 text-right"})])],-1)),s("tbody",ve,[(n(!0),r(v,null,k(i.deletedPayments,t=>(n(),r("tr",{key:t.id},[s("td",ke,[s("span",null,g(t.visit.notes?t.visit.notes:"-"),1)]),s("td",Pe,[s("span",null,[s("b",De,g(+t.amount),1)])]),s("td",Ee,[t.isEdit?u("",!0):(n(),r("span",Ce,[s("b",{class:c(["font-medium",{"text-red-500":t.remaining_amount>0}])},g(+t.remaining_amount),3)]))]),s("td",Te,[s("span",null,g(t.date),1)]),s("td",Ve,[s("a",{href:"#",title:"استعادة",class:"py-1 inline-flex h-12 px-2 text-sm text-center text-green-600 transition-colors duration-200 transform lg:h-8 hover:text-green-700 focus:outline-none",onClick:a=>d.restorePayment(t)},[p(C,{size:"5",class:"transition-colors"})],8,Me)])]))),128))])])):u("",!0)],void 0),_:1})]),i.opened?(n(),r("div",Ue,[s("div",Fe,[s("div",{class:c(`fixed inset-0 bg-gray-500 transition-opacity duration-200 ${i.opened?"bg-opacity-75":"bg-opacity-0"}`),"aria-hidden":"true",onClick:e[14]||(e[14]=t=>i.opened=!1)},null,2),e[29]||(e[29]=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),s("div",{class:c(`inline-block w-full align-bottom bg-white rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-xl sm:w-full duration-200  ${i.opened?"scale-100":"scale-0"}`)},[e[28]||(e[28]=U('<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"><svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div class="mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right"><h3 id="modal-title" class="text-lg leading-6 font-medium text-gray-900">حذف دفعة</h3><div class="mt-2"><p class="text-sm text-gray-500">هل أنت متأكد من حذف هذه الدفعة؟</p></div></div></div></div>',1)),s("div",je,[p(_,{type:"button",loading:i.submitted,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:mr-3 sm:w-auto sm:text-sm",onClick:e[15]||(e[15]=t=>d.deletePayment(i.payment_id))},{default:h(()=>e[27]||(e[27]=[y(" حذف ")]),void 0),_:1},8,["loading"]),s("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mr-3 sm:w-auto sm:text-sm",onClick:e[16]||(e[16]=t=>i.opened=!1)}," إلغاء ")])],2)])])):u("",!0)])}const Se=T(j,[["render",Ne]]);export{Se as default};
